--[[

GetDetailedItemLevelInfo Polyfill, v 1.0
by Erorus for The Undermine Journal
https://theunderminejournal.com/

Based on these "specs" for a GetDetailedItemLevelInfo function coming in 7.1
https://www.reddit.com/r/woweconomy/comments/50hp5d/warning_be_careful_flipping/d74olsy

Pass in an itemstring/link to GetDetailedItemLevelInfo
Returns effectiveItemLevel, previewItemLevel, baseItemLevel

This should use the in-game function if it already exists,
otherwise it'll define a function that does what *I think* the official function would do.

]]

local addonName, addonTable = ...
local bonusLevelBoost = {[15]=4,[44]=1,[171]=2,[448]=2,[449]=3,[450]=4,[451]=-3,[497]=50,[499]=1,[526]=1,[527]=2,[545]=2,[546]=1,[547]=1,[558]=1,[559]=2,[560]=1,[561]=1,[562]=1,[566]=1,[567]=2,[571]=1,[575]=4,[576]=6,[577]=2,[591]=4,[592]=5,[593]=3,[594]=3,[595]=2,[596]=-4,[597]=-3,[598]=-2,[599]=-1,[609]=8,[617]=4,[618]=6,[619]=4,[620]=6,[622]=1,[623]=2,[624]=3,[625]=4,[626]=5,[627]=6,[628]=7,[629]=8,[630]=9,[631]=10,[632]=11,[633]=12,[634]=13,[635]=14,[636]=15,[637]=16,[638]=17,[639]=18,[640]=19,[641]=20,[644]=4,[646]=6,[648]=5,[651]=3,[665]=3,[666]=0,[667]=1,[668]=2,[669]=3,[670]=1,[671]=2,[672]=3,[673]=4,[674]=5,[675]=6,[676]=7,[677]=8,[678]=9,[679]=10,[680]=20,[681]=22,[682]=24,[694]=15,[695]=30,[696]=45,[697]=60,[698]=75,[699]=100,[700]=5,[701]=10,[702]=3,[703]=6,[704]=12,[706]=30,[707]=15,[708]=2,[709]=4,[710]=14,[754]=1,[755]=2,[756]=3,[757]=5,[758]=6,[759]=7,[760]=8,[761]=2,[762]=3,[763]=4,[764]=6,[765]=7,[766]=8,[769]=5,[1372]=-100,[1373]=-99,[1374]=-98,[1375]=-97,[1376]=-96,[1377]=-95,[1378]=-94,[1379]=-93,[1380]=-92,[1381]=-91,[1382]=-90,[1383]=-89,[1384]=-88,[1385]=-87,[1386]=-86,[1387]=-85,[1388]=-84,[1389]=-83,[1390]=-82,[1391]=-81,[1392]=-80,[1393]=-79,[1394]=-78,[1395]=-77,[1396]=-76,[1397]=-75,[1398]=-74,[1399]=-73,[1400]=-72,[1401]=-71,[1402]=-70,[1403]=-69,[1404]=-68,[1405]=-67,[1406]=-66,[1407]=-65,[1408]=-64,[1409]=-63,[1410]=-62,[1411]=-61,[1412]=-60,[1413]=-59,[1414]=-58,[1415]=-57,[1416]=-56,[1417]=-55,[1418]=-54,[1419]=-53,[1420]=-52,[1421]=-51,[1422]=-50,[1423]=-49,[1424]=-48,[1425]=-47,[1426]=-46,[1427]=-45,[1428]=-44,[1429]=-43,[1430]=-42,[1431]=-41,[1432]=-40,[1433]=-39,[1434]=-38,[1435]=-37,[1436]=-36,[1437]=-35,[1438]=-34,[1439]=-33,[1440]=-32,[1441]=-31,[1442]=-30,[1443]=-29,[1444]=-28,[1445]=-27,[1446]=-26,[1447]=-25,[1448]=-24,[1449]=-23,[1450]=-22,[1451]=-21,[1452]=-20,[1453]=-19,[1454]=-18,[1455]=-17,[1456]=-16,[1457]=-15,[1458]=-14,[1459]=-13,[1460]=-12,[1461]=-11,[1462]=-10,[1463]=-9,[1464]=-8,[1465]=-7,[1466]=-6,[1467]=-5,[1468]=-4,[1469]=-3,[1470]=-2,[1471]=-1,[1472]=0,[1473]=1,[1474]=2,[1475]=3,[1476]=4,[1477]=5,[1478]=6,[1479]=7,[1480]=8,[1481]=9,[1482]=10,[1483]=11,[1484]=12,[1485]=13,[1486]=14,[1487]=15,[1488]=16,[1489]=17,[1490]=18,[1491]=19,[1492]=20,[1493]=21,[1494]=22,[1495]=23,[1496]=24,[1497]=25,[1498]=26,[1499]=27,[1500]=28,[1501]=29,[1502]=30,[1503]=31,[1504]=32,[1505]=33,[1506]=34,[1507]=35,[1508]=36,[1509]=37,[1510]=38,[1511]=39,[1512]=40,[1513]=41,[1514]=42,[1515]=43,[1516]=44,[1517]=45,[1518]=46,[1519]=47,[1520]=48,[1521]=49,[1522]=50,[1523]=51,[1524]=52,[1525]=53,[1526]=54,[1527]=55,[1528]=56,[1529]=57,[1530]=58,[1531]=59,[1532]=60,[1533]=61,[1534]=62,[1535]=63,[1536]=64,[1537]=65,[1538]=66,[1539]=67,[1540]=68,[1541]=69,[1542]=70,[1543]=71,[1544]=72,[1545]=73,[1546]=74,[1547]=75,[1548]=76,[1549]=77,[1550]=78,[1551]=79,[1552]=80,[1553]=81,[1554]=82,[1555]=83,[1556]=84,[1557]=85,[1558]=86,[1559]=87,[1560]=88,[1561]=89,[1562]=90,[1563]=91,[1564]=92,[1565]=93,[1566]=94,[1567]=95,[1568]=96,[1569]=97,[1570]=98,[1571]=99,[1572]=100,[1573]=101,[1574]=102,[1575]=103,[1576]=104,[1577]=105,[1578]=106,[1579]=107,[1580]=108,[1581]=109,[1582]=110,[1583]=111,[1584]=112,[1585]=113,[1586]=114,[1587]=115,[1588]=116,[1589]=117,[1590]=118,[1591]=119,[1592]=120,[1593]=121,[1594]=122,[1595]=123,[1596]=124,[1597]=125,[1598]=126,[1599]=127,[1600]=128,[1601]=129,[1602]=130,[1603]=131,[1604]=132,[1605]=133,[1606]=134,[1607]=135,[1608]=136,[1609]=137,[1610]=138,[1611]=139,[1612]=140,[1613]=141,[1614]=142,[1615]=143,[1616]=144,[1617]=145,[1618]=146,[1619]=147,[1620]=148,[1621]=149,[1622]=150,[1623]=151,[1624]=152,[1625]=153,[1626]=154,[1627]=155,[1628]=156,[1629]=157,[1630]=158,[1631]=159,[1632]=160,[1633]=161,[1634]=162,[1635]=163,[1636]=164,[1637]=165,[1638]=166,[1639]=167,[1640]=168,[1641]=169,[1642]=170,[1643]=171,[1644]=172,[1645]=173,[1646]=174,[1647]=175,[1648]=176,[1649]=177,[1650]=178,[1651]=179,[1652]=180,[1653]=181,[1654]=182,[1655]=183,[1656]=184,[1657]=185,[1658]=186,[1659]=187,[1660]=188,[1661]=189,[1662]=190,[1663]=191,[1664]=192,[1665]=193,[1666]=194,[1667]=195,[1668]=196,[1669]=197,[1670]=198,[1671]=199,[1672]=200,[1800]=24,[1810]=140,[1817]=2,[1818]=4,[1819]=3,[1820]=5,[2829]=-400,[2830]=-399,[2831]=-398,[2832]=-397,[2833]=-396,[2834]=-395,[2835]=-394,[2836]=-393,[2837]=-392,[2838]=-391,[2839]=-390,[2840]=-389,[2841]=-388,[2842]=-387,[2843]=-386,[2844]=-385,[2845]=-384,[2846]=-383,[2847]=-382,[2848]=-381,[2849]=-380,[2850]=-379,[2851]=-378,[2852]=-377,[2853]=-376,[2854]=-375,[2855]=-374,[2856]=-373,[2857]=-372,[2858]=-371,[2859]=-370,[2860]=-369,[2861]=-368,[2862]=-367,[2863]=-366,[2864]=-365,[2865]=-364,[2866]=-363,[2867]=-362,[2868]=-361,[2869]=-360,[2870]=-359,[2871]=-358,[2872]=-357,[2873]=-356,[2874]=-355,[2875]=-354,[2876]=-353,[2877]=-352,[2878]=-351,[2879]=-350,[2880]=-349,[2881]=-348,[2882]=-347,[2883]=-346,[2884]=-345,[2885]=-344,[2886]=-343,[2887]=-342,[2888]=-341,[2889]=-340,[2890]=-339,[2891]=-338,[2892]=-337,[2893]=-336,[2894]=-335,[2895]=-334,[2896]=-333,[2897]=-332,[2898]=-331,[2899]=-330,[2900]=-329,[2901]=-328,[2902]=-327,[2903]=-326,[2904]=-325,[2905]=-324,[2906]=-323,[2907]=-322,[2908]=-321,[2909]=-320,[2910]=-319,[2911]=-318,[2912]=-317,[2913]=-316,[2914]=-315,[2915]=-314,[2916]=-313,[2917]=-312,[2918]=-311,[2919]=-310,[2920]=-309,[2921]=-308,[2922]=-307,[2923]=-306,[2924]=-305,[2925]=-304,[2926]=-303,[2927]=-302,[2928]=-301,[2929]=-300,[2930]=-299,[2931]=-298,[2932]=-297,[2933]=-296,[2934]=-295,[2935]=-294,[2936]=-293,[2937]=-292,[2938]=-291,[2939]=-290,[2940]=-289,[2941]=-288,[2942]=-287,[2943]=-286,[2944]=-285,[2945]=-284,[2946]=-283,[2947]=-282,[2948]=-281,[2949]=-280,[2950]=-279,[2951]=-278,[2952]=-277,[2953]=-276,[2954]=-275,[2955]=-274,[2956]=-273,[2957]=-272,[2958]=-271,[2959]=-270,[2960]=-269,[2961]=-268,[2962]=-267,[2963]=-266,[2964]=-265,[2965]=-264,[2966]=-263,[2967]=-262,[2968]=-261,[2969]=-260,[2970]=-259,[2971]=-258,[2972]=-257,[2973]=-256,[2974]=-255,[2975]=-254,[2976]=-253,[2977]=-252,[2978]=-251,[2979]=-250,[2980]=-249,[2981]=-248,[2982]=-247,[2983]=-246,[2984]=-245,[2985]=-244,[2986]=-243,[2987]=-242,[2988]=-241,[2989]=-240,[2990]=-239,[2991]=-238,[2992]=-237,[2993]=-236,[2994]=-235,[2995]=-234,[2996]=-233,[2997]=-232,[2998]=-231,[2999]=-230,[3000]=-229,[3001]=-228,[3002]=-227,[3003]=-226,[3004]=-225,[3005]=-224,[3006]=-223,[3007]=-222,[3008]=-221,[3009]=-220,[3010]=-219,[3011]=-218,[3012]=-217,[3013]=-216,[3014]=-215,[3015]=-214,[3016]=-213,[3017]=-212,[3018]=-211,[3019]=-210,[3020]=-209,[3021]=-208,[3022]=-207,[3023]=-206,[3024]=-205,[3025]=-204,[3026]=-203,[3027]=-202,[3028]=-201,[3029]=-200,[3030]=-199,[3031]=-198,[3032]=-197,[3033]=-196,[3034]=-195,[3035]=-194,[3036]=-193,[3037]=-192,[3038]=-191,[3039]=-190,[3040]=-189,[3041]=-188,[3042]=-187,[3043]=-186,[3044]=-185,[3045]=-184,[3046]=-183,[3047]=-182,[3048]=-181,[3049]=-180,[3050]=-179,[3051]=-178,[3052]=-177,[3053]=-176,[3054]=-175,[3055]=-174,[3056]=-173,[3057]=-172,[3058]=-171,[3059]=-170,[3060]=-169,[3061]=-168,[3062]=-167,[3063]=-166,[3064]=-165,[3065]=-164,[3066]=-163,[3067]=-162,[3068]=-161,[3069]=-160,[3070]=-159,[3071]=-158,[3072]=-157,[3073]=-156,[3074]=-155,[3075]=-154,[3076]=-153,[3077]=-152,[3078]=-151,[3079]=-150,[3080]=-149,[3081]=-148,[3082]=-147,[3083]=-146,[3084]=-145,[3085]=-144,[3086]=-143,[3087]=-142,[3088]=-141,[3089]=-140,[3090]=-139,[3091]=-138,[3092]=-137,[3093]=-136,[3094]=-135,[3095]=-134,[3096]=-133,[3097]=-132,[3098]=-131,[3099]=-130,[3100]=-129,[3101]=-128,[3102]=-127,[3103]=-126,[3104]=-125,[3105]=-124,[3106]=-123,[3107]=-122,[3108]=-121,[3109]=-120,[3110]=-119,[3111]=-118,[3112]=-117,[3113]=-116,[3114]=-115,[3115]=-114,[3116]=-113,[3117]=-112,[3118]=-111,[3119]=-110,[3120]=-109,[3121]=-108,[3122]=-107,[3123]=-106,[3124]=-105,[3125]=-104,[3126]=-103,[3127]=-102,[3128]=-101,[3130]=201,[3131]=202,[3132]=203,[3133]=204,[3134]=205,[3135]=206,[3136]=207,[3137]=208,[3138]=209,[3139]=210,[3140]=211,[3141]=212,[3142]=213,[3143]=214,[3144]=215,[3145]=216,[3146]=217,[3147]=218,[3148]=219,[3149]=220,[3150]=221,[3151]=222,[3152]=223,[3153]=224,[3154]=225,[3155]=226,[3156]=227,[3157]=228,[3158]=229,[3159]=230,[3160]=231,[3161]=232,[3162]=233,[3163]=234,[3164]=235,[3165]=236,[3166]=237,[3167]=238,[3168]=239,[3169]=240,[3170]=241,[3171]=242,[3172]=243,[3173]=244,[3174]=245,[3175]=246,[3176]=247,[3177]=248,[3178]=249,[3179]=250,[3180]=251,[3181]=252,[3182]=253,[3183]=254,[3184]=255,[3185]=256,[3186]=257,[3187]=258,[3188]=259,[3189]=260,[3190]=261,[3191]=262,[3192]=263,[3193]=264,[3194]=265,[3195]=266,[3196]=267,[3197]=268,[3198]=269,[3199]=270,[3200]=271,[3201]=272,[3202]=273,[3203]=274,[3204]=275,[3205]=276,[3206]=277,[3207]=278,[3208]=279,[3209]=280,[3210]=281,[3211]=282,[3212]=283,[3213]=284,[3214]=285,[3215]=286,[3216]=287,[3217]=288,[3218]=289,[3219]=290,[3220]=291,[3221]=292,[3222]=293,[3223]=294,[3224]=295,[3225]=296,[3226]=297,[3227]=298,[3228]=299,[3229]=300,[3230]=301,[3231]=302,[3232]=303,[3233]=304,[3234]=305,[3235]=306,[3236]=307,[3237]=308,[3238]=309,[3239]=310,[3240]=311,[3241]=312,[3242]=313,[3243]=314,[3244]=315,[3245]=316,[3246]=317,[3247]=318,[3248]=319,[3249]=320,[3250]=321,[3251]=322,[3252]=323,[3253]=324,[3254]=325,[3255]=326,[3256]=327,[3257]=328,[3258]=329,[3259]=330,[3260]=331,[3261]=332,[3262]=333,[3263]=334,[3264]=335,[3265]=336,[3266]=337,[3267]=338,[3268]=339,[3269]=340,[3270]=341,[3271]=342,[3272]=343,[3273]=344,[3274]=345,[3275]=346,[3276]=347,[3277]=348,[3278]=349,[3279]=350,[3280]=351,[3281]=352,[3282]=353,[3283]=354,[3284]=355,[3285]=356,[3286]=357,[3287]=358,[3288]=359,[3289]=360,[3290]=361,[3291]=362,[3292]=363,[3293]=364,[3294]=365,[3295]=366,[3296]=367,[3297]=368,[3298]=369,[3299]=370,[3300]=371,[3301]=372,[3302]=373,[3303]=374,[3304]=375,[3305]=376,[3306]=377,[3307]=378,[3308]=379,[3309]=380,[3310]=381,[3311]=382,[3312]=383,[3313]=384,[3314]=385,[3315]=386,[3316]=387,[3317]=388,[3318]=389,[3319]=390,[3320]=391,[3321]=392,[3322]=393,[3323]=394,[3324]=395,[3325]=396,[3326]=397,[3327]=398,[3328]=399,[3329]=400,[3330]=3,[3331]=1,[3332]=6,[3333]=7,[3334]=8,[3340]=2,[3381]=0,[3382]=1,[3383]=2,[3384]=4,[3393]=4,[3438]=8,[3439]=11,[3440]=14,[3455]=30,[3492]=2,[3493]=26,[3494]=34,[3526]=16,[3530]=3,[3570]=6,[3571]=90,[3586]=45,[3587]=6,[3588]=9,[3593]=1,[3594]=2,[3595]=3,[3598]=0,[3599]=1,[3600]=2,[3601]=3,[3602]=4,[3603]=5,[3604]=6,[3605]=7,[3606]=8,[3607]=9,[3608]=10,[3630]=9,[3824]=-1,[3825]=1,[3826]=2,[3827]=3,[3986]=5,[3987]=10,[3988]=15,[3989]=20,[3990]=25,[3991]=30,[3992]=35,[3993]=40,[3994]=45,[3995]=50,[3996]=55,[3997]=60,[4213]=88,[4232]=15,[4775]=5,[4797]=-30,[4926]=8,[4928]=10,[4929]=0,[4930]=0,[4931]=0,[4936]=0,[4948]=-20,[4949]=-10,[4950]=0,[5117]=-15,[5118]=-5,[5375]=25,[5814]=0,[5846]=1,[5847]=2,[5848]=3,[5849]=4,[5850]=5,[5851]=6,[5852]=7,[5853]=8,[5854]=9,[5855]=10,[5856]=11,[5857]=12,[5858]=13,[5859]=14,[5860]=15,[5861]=16,[5862]=17,[5863]=18,[5864]=19,[5865]=20,[5866]=21,[5867]=22,[5868]=23,[5869]=24,[5870]=25,[5871]=26,[5872]=27,[5873]=28,[5874]=29,[5875]=30,[5876]=31,[5877]=32,[5878]=33,[5879]=34,[5880]=35,[5881]=36,[5882]=37,[5883]=38,[5884]=39,[5885]=40,[5886]=41,[5887]=42,[5888]=43,[5889]=44,[5890]=45,[5891]=46,[5892]=47,[5893]=48,[5894]=49,[5895]=50,[5896]=51,[5897]=52,[5898]=53,[5899]=54,[5900]=55,[5901]=56,[5902]=57,[5903]=58,[5904]=59,[5905]=60,[5906]=61,[5907]=62,[5908]=63,[5909]=64,[5910]=65,[5911]=66,[5912]=67,[5913]=68,[5914]=69,[5915]=70,[5916]=71,[5917]=72,[5918]=73,[5919]=74,[5920]=75,[5921]=76,[5922]=77,[5923]=78,[5924]=79,[5925]=80,[5926]=81,[5927]=82,[5928]=83,[5929]=84,[5930]=85,[5931]=86,[5932]=87,[5933]=88,[5934]=89,[5935]=90,[5936]=91,[5937]=92,[5938]=93,[5939]=94,[5940]=95,[5941]=96,[5942]=97,[5943]=98,[5944]=99,[5945]=100,[5946]=101,[5947]=102,[5948]=103,[5949]=104,[5950]=105,[5951]=106,[5952]=107,[5953]=108,[5954]=109,[5955]=110,[5956]=111,[5957]=112,[5958]=113,[5959]=114,[5960]=115,[5961]=116,[5962]=117,[5963]=118,[5964]=119,[5965]=120,[5966]=121,[5967]=122,[5968]=123,[5969]=124,[5970]=125,[5971]=126,[5972]=127,[5973]=128,[5974]=129,[5975]=130,[5976]=131,[5977]=132,[5978]=133,[5979]=134,[5980]=135,[5981]=136,[5982]=137,[5983]=138,[5984]=139,[5985]=140,[5986]=141,[5987]=142,[5988]=143,[5989]=144,[5990]=145,[5991]=146,[5992]=147,[5993]=148,[5994]=149,[5995]=150,[5996]=151,[5997]=152,[5998]=153,[5999]=154,[6000]=155,[6001]=156,[6002]=157,[6003]=158,[6004]=159,[6005]=160,[6006]=161,[6007]=162,[6008]=163,[6009]=164,[6010]=165,[6011]=166,[6012]=167,[6013]=168,[6014]=169,[6015]=170,[6016]=171,[6017]=172,[6018]=173,[6019]=174,[6020]=175,[6021]=176,[6022]=177,[6023]=178,[6024]=179,[6025]=180,[6026]=181,[6027]=182,[6028]=183,[6029]=184,[6030]=185,[6031]=186,[6032]=187,[6033]=188,[6034]=189,[6035]=190,[6036]=191,[6037]=192,[6038]=193,[6039]=194,[6040]=195,[6041]=196,[6042]=197,[6043]=198,[6044]=199,[6045]=200,[6046]=201,[6047]=202,[6048]=203,[6049]=204,[6050]=205,[6051]=206,[6052]=207,[6053]=208,[6054]=209,[6055]=210,[6056]=211,[6057]=212,[6058]=213,[6059]=214,[6060]=215,[6061]=216,[6062]=217,[6063]=218,[6064]=219,[6065]=220,[6066]=221,[6067]=222,[6068]=223,[6069]=224,[6070]=225,[6071]=226,[6072]=227,[6073]=228,[6074]=229,[6075]=230,[6076]=231,[6077]=232,[6078]=233,[6079]=234,[6080]=235,[6081]=236,[6082]=237,[6083]=238,[6084]=239,[6085]=240,[6086]=241,[6087]=242,[6088]=243,[6089]=244,[6090]=245,[6091]=246,[6092]=247,[6093]=248,[6094]=249,[6095]=250,[6096]=251,[6097]=252,[6098]=253,[6099]=254,[6100]=255,[6101]=256,[6102]=257,[6103]=258,[6104]=259,[6105]=260,[6106]=261,[6107]=262,[6108]=263,[6109]=264,[6110]=265,[6111]=266,[6112]=267,[6113]=268,[6114]=269,[6115]=270,[6116]=271,[6117]=272,[6118]=273,[6119]=274,[6120]=275,[6121]=276,[6122]=277,[6123]=278,[6124]=279,[6125]=280,[6126]=281,[6127]=282,[6128]=283,[6129]=284,[6130]=285,[6131]=286,[6132]=287,[6133]=288,[6134]=289,[6135]=290,[6136]=291,[6137]=292,[6138]=293,[6139]=294,[6140]=295,[6141]=296,[6142]=297,[6143]=298,[6144]=299,[6145]=300,[6146]=301,[6147]=302,[6148]=303,[6149]=304,[6150]=305,[6151]=306,[6152]=307,[6153]=308,[6154]=309,[6155]=310,[6156]=311,[6157]=312,[6158]=313,[6159]=314,[6160]=315,[6161]=316,[6162]=317,[6163]=318,[6164]=319,[6165]=320,[6166]=321,[6167]=322,[6168]=323,[6169]=324,[6170]=325,[6171]=326,[6172]=327,[6173]=328,[6174]=329,[6175]=330,[6176]=331,[6177]=332,[6178]=333,[6179]=334,[6180]=335,[6181]=336,[6182]=337,[6183]=338,[6184]=339,[6185]=340,[6186]=341,[6187]=342,[6188]=343,[6189]=344,[6190]=345,[6191]=346,[6192]=347,[6193]=348,[6194]=349,[6195]=350,[6196]=351,[6197]=352,[6198]=353,[6199]=354,[6200]=355,[6201]=356,[6202]=357,[6203]=358,[6204]=359,[6205]=360,[6206]=361,[6207]=362,[6208]=363,[6209]=364,[6210]=365,[6211]=366,[6212]=367,[6213]=368,[6214]=369,[6215]=370,[6216]=371,[6217]=372,[6218]=373,[6219]=374,[6220]=375,[6221]=376,[6222]=377,[6223]=378,[6224]=379,[6225]=380,[6226]=381,[6227]=382,[6228]=383,[6229]=384,[6230]=385,[6231]=386,[6232]=387,[6233]=388,[6234]=389,[6235]=390,[6236]=391,[6237]=392,[6238]=393,[6239]=394,[6240]=395,[6241]=396,[6242]=397,[6243]=398,[6244]=399,[6245]=400,[6273]=2,[6274]=4,[6275]=6,[6276]=8,[6277]=10,[6278]=12,[6279]=14,[6280]=16,[6281]=18,[6282]=20,[6283]=22,[6284]=24,[6285]=26,[6286]=30,[6316]=0,[6577]=30,[6580]=30,[6581]=30,[6582]=30,[6583]=30,[6584]=30,[6585]=30,[6586]=30,[6587]=30,[6588]=30,[6589]=30,[6590]=30,[6591]=30,[6592]=30,[6593]=30,[6594]=30,[6595]=30,[6596]=30,[6597]=30,[6598]=30,[6599]=30,[6600]=30,[6601]=30,[6602]=30,[6603]=30,[6665]=40,[6666]=60,[6667]=150,[6668]=162,}
local bonusPreviewLevel = {[1726]=845,[1727]=865,[1798]=705,[1799]=720,[1801]=690,[1805]=865,[1806]=880,[1807]=850,[1824]=0,[1825]=0,[1826]=825,[3379]=835,[3394]=0,[3395]=0,[3396]=0,[3397]=0,[3399]=840,[3410]=870,[3411]=870,[3412]=875,[3413]=875,[3414]=880,[3415]=880,[3416]=885,[3417]=885,[3418]=890,[3427]=805,[3428]=840,[3432]=0,[3437]=830,[3443]=870,[3444]=885,[3445]=900,[3446]=855,[3449]=850,[3450]=860,[3451]=865,[3452]=855,[3453]=860,[3454]=875,[3457]=810,[3460]=810,[3461]=815,[3462]=855,[3463]=865,[3464]=875,[3465]=885,[3466]=860,[3467]=860,[3468]=875,[3469]=890,[3470]=845,[3473]=0,[3474]=0,[3476]=870,[3477]=875,[3478]=880,[3479]=890,[3480]=900,[3481]=880,[3482]=815,[3483]=820,[3484]=825,[3485]=830,[3486]=835,[3487]=820,[3488]=825,[3489]=830,[3490]=835,[3491]=840,[3505]=850,[3506]=865,[3507]=880,[3508]=895,[3509]=895,[3510]=895,[3514]=875,[3515]=880,[3516]=890,[3517]=895,[3518]=905,[3519]=910,[3520]=860,[3521]=865,[3534]=900,[3535]=905,[3536]=910,[3561]=870,[3562]=885,[3563]=900,[3564]=855,[3565]=810,[3566]=810,[3567]=810,[3568]=810,[3572]=0,[3575]=855,[3576]=855,[3577]=855,[3579]=810,[3580]=810,[3581]=810,[3582]=810,[3583]=810,[3584]=810,[3610]=870,[3611]=885,[3612]=900,[3613]=855,[3614]=860,[4798]=880,[4799]=895,[4800]=910,[4801]=865,[5119]=0,[5479]=0,}
local bonusLevelCurve = {}
local curvePoints = {}

local function round(num)
    return floor(num + 0.5)
end

local function GetCurvePoint(curveId, point)
    local curve = curvePoints[curveId]
    if not curve then
        return nil
    end

    local lastKey, lastValue = curve[1][1], curve[1][2]
    if lastKey > point then
        return lastValue
    end

    for x = 1,#curve,1 do
        if point == curve[x][1] then
            return curve[x][2]
        end
        if point < curve[x][1] then
            return round((curve[x][2] - lastValue) / (curve[x][1] - lastKey) * (point - lastKey) + lastValue)
        end
        lastKey = curve[x][1]
        lastValue = curve[x][2]
    end

    return lastValue
end

addonTable.GetDetailedItemLevelInfo = function(item)
    local _, link, _, origLevel = GetItemInfo(item)
    if not link then
        return nil, nil, nil
    end

    local itemString = string.match(link, "item[%-?%d:]+")
    local itemStringParts = { strsplit(":", itemString) }

    local numBonuses = tonumber(itemStringParts[14],10) or 0

    if numBonuses == 0 then
        return origLevel, nil, origLevel
    end

    local effectiveLevel, previewLevel, curve
    effectiveLevel = origLevel
    previewLevel = 0

    for y = 1,numBonuses,1 do
        local bonus = tonumber(itemStringParts[14+y],10) or 0

        origLevel = origLevel - (bonusLevelBoost[bonus] or 0)
        previewLevel = bonusPreviewLevel[bonus] or previewLevel
        curve = bonusLevelCurve[bonus] or curve
    end

    if curve and itemStringParts[12] == "512" then
        effectiveLevel = GetCurvePoint(curve, tonumber(itemStringParts[15+numBonuses],10)) or effectiveLevel
    end

    return effectiveLevel, previewLevel, origLevel
end
